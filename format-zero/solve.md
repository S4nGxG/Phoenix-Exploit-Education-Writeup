## <center>[FORMAT ZERO](https://exploit.education/phoenix/format-zero/)</center>
>This level introduces format strings, and how attacker supplied format strings can modify program execution.
> ##### Hints
> - man 3 printf
> - Exploiting Format String Vulnerabilities

#### Source code
```c
/*
 * phoenix/format-zero, by https://exploit.education
 *
 * Can you change the "changeme" variable?
 *
 * 0 bottles of beer on the wall, 0 bottles of beer! You take one down, and
 * pass it around, 4294967295 bottles of beer on the wall!
 */

#include <err.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

int main(int argc, char **argv) {
  struct {
    char dest[32];
    volatile int changeme;
  } locals;
  char buffer[16];

  printf("%s\n", BANNER);

  if (fgets(buffer, sizeof(buffer) - 1, stdin) == NULL) {
    errx(1, "Unable to get buffer");
  }
  buffer[15] = 0;

  locals.changeme = 0;

  sprintf(locals.dest, buffer);

  if (locals.changeme != 0) {
    puts("Well done, the 'changeme' variable has been changed!");
  } else {
    puts(
        "Uh oh, 'changeme' has not yet been changed. Would you like to try "
        "again?");
  }

  exit(0);
}
```
### Solution:
- Ở `format-zero` này ta sẽ tìm hiểu về `Exploiting Format String Vulnerabilities`
- Đọc source code ta thấy chương trình sẽ nhận đầu vào tối đa 15 kí tự vào mảng `buffer`. Sau khi nhận đầu vào thành công thì nội dung của mảng `buffer` sẽ được sao chép vào `locals.dest`. Cuối cùng kiểm tra xem biến `changeme` có thay đổi không, nếu thayu đổi thì sẽ hoàn thành thử thách
- Bài này ta không thể sử dụng tràn bộ đệm để giải quyết vì đầu vào tối đa 15 kí tự mà mảng char `locals.dest` được khai báo 32 byte nên không thể ghi đè giá trị vào biến `changeme`
- Tuy nhiên, chương trình sử dụng hàm  `sprintf` để định dạng mảng char `buffer` và ghi dữ liệu vào bộ đệm `locals.dest`
- Lợi dụng lỗ hỏng chuỗi định dạng đó ta có thể ghi `%x` chỉ 2 kí tự nhưng khi qua hàm `sprintf` thì nó sẽ có dạng giá trị hex gồm 8 kí tự
- Vậy muốn điền vào bộ đệm của `locals.dest` 32 kí tự thì ta có thể sử dụng `%<pading>x`, trong đó pading là số lượng kí tự trống, và khi `enter` hàm `sprintf` tự động lưu ký tự xuống dòng có giá trị là `0x0a` vào bộ đệm lân cận
```
user@phoenix-amd64:/opt/phoenix/amd64$ ./format-zero
Welcome to phoenix/format-zero, brought to you by https://exploit.education
%32x
Well done, the 'changeme' variable has been changed!
```